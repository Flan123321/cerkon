// Archivo: src/utils/simplexNoise.js
// (Copia y pega este c√≥digo completo)

// --- Funciones de Ruido Perlin (Simplex Noise) ---
// Adaptadas de: https://github.com/josephg/noisejs
function grad3(i, x, y, z) {
  const h = i & 15;
  const u = h < 8 ? x : y;
  const v = h < 4 ? y : (h === 12 || h === 14 ? x : z);
  return ((h & 1) === 0 ? u : -u) + ((h & 2) === 0 ? v : -v);
}

export function simplexNoise3D(x, y, z, seed) {
  const p = new Array(512);
  const permutation = [151,160,137,91,90,15,
  131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,
  190, 6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,
  88,237,149,56,87,178,85,9,165,220,68,109,204,244,192,47,112,64,73,63,161,215,
  188,150,166,146,183,243,105,171,50,58,193,83,180,10,95,74,226,110,135,221,132,
  77,15,200,81,72,218,124,181,189,14,34,55,207,172,98,99,236,24,196,164,159,84,
  138,100,22,206,170,118,208,255,16,66,220,38,130,234,44,143,169,179,101,87,195,
  145,182,212,148,157,67,163,89,167,238,202,242,125,93,168,214,213,211,216,106,
  162,49,205,43,198,173,174,184,175,251,209,160,158,228,78,139,152,70,162,60,
  128,231,17,28,40,250,119,39,173,121,20,111,107,59,10,248,176,144,249,29,191,
  154,166,133,227,153,61,156,239,241,126,129,54,141,176,136,115,217,147,185,191,
  15,246,104,175,123,82,108,52,69,210,79,114,232,155,134,186,187,60,127,199,
  171,86,132,46,122,229,149,42,202,109,51,200,92,45,213,116,4,222,46,245,71,138,
  113,29,102,12,76,21,123,73,97,48,244,164,74,115,180,195,135,165,159,208,240,
  242,216,66,106,125,93,168,214,198,173,174,211,175,251,209,160,158,228,78,139,
  152,70,162,60,128,231,17,28,40,250,119,39,173,121,20,111,107,59,10,248,176,144,
  249,29,191,154,166,133,227,153,61,156,239,241,126,129,54,141,176,136,115,217,
  147,185,191,15,246,104,175,123,82,108,52,69,210,79,114,232,155,134,186,187,60,
  127,199];

  for (let i = 0; i < 256; i++) {
    p[256 + i] = p[i] = permutation[i] + seed;
  }

  const F3 = 1 / 3;
  const G3 = 1 / 6;

  const s = (x + y + z) * F3;
  const xs = x + s;
  const ys = y + s;
  const zs = z + s;

  const i = Math.floor(xs);
  const j = Math.floor(ys);
  const k = Math.floor(zs);

  const t = (i + j + k) * G3;
  const X0 = i - t;
  const Y0 = j - t;
  const Z0 = k - t;

  const x0 = x - X0;
  const y0 = y - Y0;
  const z0 = z - Z0;

  const i1 = x0 >= y0 ? (x0 >= z0 ? 1 : 0) : (y0 >= z0 ? 0 : 0);
  const j1 = x0 >= y0 ? (x0 >= z0 ? 0 : 1) : (y0 >= z0 ? 1 : 0);
  const k1 = x0 >= y0 ? (x0 >= z0 ? 0 : 0) : (y0 >= z0 ? 0 : (y0 >= x0 ? 0 : 1));

  const x1 = x0 - i1 + G3;
  const y1 = y0 - j1 + G3;
  const z1 = z0 - k1 + G3;

  const x2 = x0 - 1 + G3 * 2;
  const y2 = y0 - 1 + G3 * 2;
  const z2 = z0 - 1 + G3 * 2;

  const gi0 = p[i + p[j + p[k]]] % 12;
  const gi1 = p[i + i1 + p[j + j1 + p[k + k1]]] % 12;
  const gi2 = p[i + 1 + p[j + 1 + p[k + 1]]] % 12;
  const gi3 = p[i + 1 + p[j + 1 + p[k + 1]]] % 12;

  let n = 0;
  let t0 = 0.5 - x0 * x0 - y0 * y0 - z0 * z0;
  if (t0 >= 0) {
    t0 *= t0;
    n += t0 * t0 * grad3(gi0, x0, y0, z0);
  }

  let t1 = 0.5 - x1 * x1 - y1 * y1 - z1 * z1;
  if (t1 >= 0) {
    t1 *= t1;
    n += t1 * t1 * grad3(gi1, x1, y1, z1);
  }

  let t2 = 0.5 - x2 * x2 - y2 * y2 - z2 * z2;
  if (t2 >= 0) {
    t2 *= t2;
    n += t2 * t2 * grad3(gi2, x2, y2, z2);
  }

  return 32 * n;
}